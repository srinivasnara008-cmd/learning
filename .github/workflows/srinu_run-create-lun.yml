name: Run Create LUN Robot Test

on:
  workflow_dispatch:
    inputs:
      targetIndex:
        description: "Target index for the LUN"
        required: false
        default: "1"
      createRaid:
        description: "RAID configuration (e.g. 1, 5, 6, 10)"
        required: false
        default: ""
      lunSize:
        description: "LUN size (e.g. 100G)"
        required: false
        default: ""
      hddType:
        description: "HDD type (e.g. SAS, SATA, SSD)"
        required: false
        default: ""
      driveCount:
        description: "Drive count for RAID"
        required: false
        default: ""
      stripeSize:
        description: "Stripe size"
        required: false
        default: ""
      forceCreate:
        description: "Force create LUN (yes/no)"
        required: false
        default: "no"
      negativeTest:
        description: "Is this a negative test? (yes/no)"
        required: false
        default: "no"
      testFile:
        description: "Robot/RoboGalaxy test file to run"
        required: true
        default: "tests/createLun.txt"

jobs:
  run-create-lun:
    runs-on: windows-latest   # Using Windows to match your backslash paths

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Robot Framework (and deps if available)
        shell: pwsh
        run: |
          python -m pip install --upgrade pip
          if (Test-Path "requirements.txt") {
            pip install -r requirements.txt
          } else {
            pip install robotframework
          }

      - name: Run Create LUN Robot test with inputs (using pybot)
        shell: pwsh
        run: |
          # If pybot exists (older RF), use it. Otherwise fall back to `robot`.
          if (Get-Command pybot -ErrorAction SilentlyContinue) {
            pybot `
              -v targetIndex:${{ github.event.inputs.targetIndex }} `
              -v createRaid:${{ github.event.inputs.createRaid }} `
              -v lunSize:${{ github.event.inputs.lunSize }} `
              -v hddType:${{ github.event.inputs.hddType }} `
              -v driveCount:${{ github.event.inputs.driveCount }} `
              -v stripeSize:${{ github.event.inputs.stripeSize }} `
              -v forceCreate:${{ github.event.inputs.forceCreate }} `
              -v negativeTest:${{ github.event.inputs.negativeTest }} `
              ${{ github.event.inputs.testFile }}
          } else {
            robot `
              -v targetIndex:${{ github.event.inputs.targetIndex }} `
              -v createRaid:${{ github.event.inputs.createRaid }} `
              -v lunSize:${{ github.event.inputs.lunSize }} `
              -v hddType:${{ github.event.inputs.hddType }} `
              -v driveCount:${{ github.event.inputs.driveCount }} `
              -v stripeSize:${{ github.event.inputs.stripeSize }} `
              -v forceCreate:${{ github.event.inputs.forceCreate }} `
              -v negativeTest:${{ github.event.inputs.negativeTest }} `
              ${{ github.event.inputs.testFile }}
          }
